function Paddle(a,b,c,e,f,d){this.defaultSpeed=d>>6;this.x=a;this.frontX=b;this.y=c;this.width=e;this.height=f;this.minY=this.halfHeight=this.height>>1;this.maxY=d-this.height-this.halfHeight;this.topSection=this.height>>2;this.bottomSection=this.height-(this.height>>2)}function Player(a,b){this.court=a;this.name=b}Player.prototype.givePaddle=function(a){this.paddle=a};ComputerPlayer.prototype=new Player;function ComputerPlayer(a,b){Player.apply(this,a);this.name=b}
ComputerPlayer.prototype.updatePaddle=function(a){return-(this.paddle.y+this.paddle.halfHeight-a.y)>>3};ComputerPlayer.prototype.gameOver=function(a){};
function Ball(a,b){this.court=a;this.ballSize=b;this.halfBallSize=b>>1;this.x=(this.court.width>>1)-this.halfBallSize;this.y=Math.floor(Math.random()*this.court.height);this.minX=-this.halfBallSize;this.maxX=this.court.width-this.halfBallSize;this.minY=-this.halfBallSize;this.maxY=this.court.height-this.halfBallSize;this.y_speed=-2;this.x_speed=a.width>>7}
Ball.prototype.bouncePaddle=function(a){this.x_speed=-(this.x_speed+1);this.y<a.y+a.topSection?this.y_speed=0==this.y_speed?court.height>>8:0<this.y_speed?-this.y_speed:this.y_speed<<1:this.y>a.y+a.bottomSection&&(this.y_speed=0==this.y_speed?-court.height>>8:0<this.y_speed?this.y_speed<<1:-this.y_speed);window.audio.src="paddle.mp3";window.audio.play()};
Ball.prototype.getCollisons=function(){if(this.y<=this.minY)return this.y=this.minY,this.y_speed=-this.y_speed,window.audio.src="wall.mp3",window.audio.play(),0;if(this.y>=this.maxY)return this.y=this.maxY,this.y_speed=-this.y_speed,window.audio.src="wall.mp3",window.audio.play(),0;if(0>this.x_speed){if(this.x<=this.court.paddles[0].frontX){if(this.x<this.minX)return-1;if(this.y+this.ballSize>this.court.paddles[0].y&&this.y<this.court.paddles[0].y+this.court.paddles[0].height)return this.bouncePaddle(this.court.paddles[0]),
1}}else if(this.x>=this.court.paddles[1].frontX){if(this.x>this.maxX)return-2;if(this.y+this.ballSize>this.court.paddles[1].y&&this.y<this.court.paddles[1].y+this.court.paddles[1].height)return this.bouncePaddle(this.court.paddles[1]),2}return 0};
function Game(a){console.log("New Game");this.court=a;this.court.game=this;this.pointsToWin=21;for(this.court.ball=new Ball(this.court,this.court.ballSize);2>this.court.numPlayers;)this.court.enter(new ComputerPlayer(this.court,"Computer"));this.court.players[0].score=0;this.court.players[1].score=0;this.court.scoreboard.leftScore.innerHTML=this.court.players[0].score.toString();this.court.scoreboard.rightScore.innerHTML=this.court.players[1].score.toString()}
Game.prototype.point=function(a,b){console.log("Point for player: "+a.name);this.court.scoreboard.pointWon(a);a.score==this.pointsToWin?this.end(a,b):this.court.ball=new Ball(this.court,this.court.ballSize)};Game.prototype.end=function(a,b){console.log("End of game. '"+a.name+"' wins");a.gameOver(!0);b.gameOver(!1);this.court.pausePlay();this.court.game=null;window.message("GAME OVER")};
function ScoreBoard(a,b){this.court=a;this.leftScore=b.getElementsByClassName("left")[0];this.rightScore=b.getElementsByClassName("right")[0]}ScoreBoard.prototype.pointWon=function(a){window.audio.src="point.mp3";window.audio.play();a.score++;this.leftScore.innerHTML=this.court.players[0].score.toString();this.rightScore.innerHTML=this.court.players[1].score.toString()};
function Court(a){this.context=a.getContext("2d");this.width=a.width;this.height=a.height;this.context.fillStyle="#FFFFFF";this.ballSize=10;a=Math.floor((this.height-50)/2);this.paddles=Array(2);this.paddles[0]=new Paddle(60,70,a,10,50,this.height,this.context);var b=this.width-60-10;this.paddles[1]=new Paddle(b,b-this.ballSize,a,10,50,this.height);this.scoreboard=new ScoreBoard(this,document.getElementById("scoreboard"));this.paused=!1;this.players=Array(2);this.players[0]=null;this.players[1]=null;
this.numPlayers=0;this.game=null;this.moves=[];this.result=0;window.message(this.enterMessage);window.court=this}
Court.prototype.enter=function(a){null==this.players[0]?(this.players[0]=a,this.players[0].givePaddle(this.paddles[0]),this.context.fillRect(this.paddles[0].x,this.paddles[0].y,this.paddles[0].width,this.paddles[0].height),this.numPlayers++,console.log("Player '"+a.name+"' enters court, gets left paddle"),a="PADDLE YES LEFT"):null==this.players[1]?(this.players[1]=a,this.players[1].givePaddle(this.paddles[1]),this.context.fillRect(this.paddles[1].x,this.paddles[1].y,this.paddles[1].width,this.paddles[1].height),
this.numPlayers++,console.log("Player '"+a.name+"' enters court, gets right paddle"),a="PADDLE YES RIGHT"):(console.log("PADDLE NONE"),a="PADDLE NONE");window.message(window.court.startMessage);return a};
Court.prototype.leave=function(a){var b;console.log("Player '"+a.name+"' has left the court");a==this.players[0]?(b=this.players[1],this.players[0]=null):(b=this.players[0],this.players[1]=null);this.game?this.game.end(b,a):window.message(this.enterMessage);this.numPlayers--;this.ball&&this.context.clearRect(this.ball.x-this.ball.halfBallSize,this.ball.y-this.halfBallSize,this.ball.ballSize,this.ball.ballSize);this.context.clearRect(a.paddle.x,a.paddle.y,a.paddle.width,a.paddle.height);a.paddle=null};
Court.prototype.draw=function(){var a=1;do{var b=this.players[a];if(b){var c=b.paddle;c&&(this.moves[a]=b.updatePaddle(this.ball),0!=this.moves[a]&&(this.context.clearRect(this.paddles[a].x,this.paddles[a].y,this.paddles[a].width,this.paddles[a].height),c.y+=this.moves[a],c.y<=c.minY?c.y=c.minY:c.y>=c.maxY&&(c.y=c.maxY)))}}while(0<=--a);1<window.debug&&console.log("    elapsed time to clear() and move() paddles: "+(performance.now()-window.start)+" ms");this.ball&&(this.context.clearRect(this.ball.x,
this.ball.y,this.ball.ballSize,this.ball.ballSize),this.result=this.ball.getCollisons(),this.ball.x+=this.ball.x_speed,this.ball.y+=this.ball.y_speed,this.context.fillRect(this.ball.x,this.ball.y,this.ball.ballSize,this.ball.ballSize),1<window.debug&&console.log("    elapsed time to end of ball.getCollisons: "+(performance.now()-window.start)+" ms"),0>this.result&&(this.context.clearRect(this.ball.x,this.ball.y,this.ball.ballSize,this.ball.ballSize),-1==this.result?this.game.point(this.players[1],
this.players[0]):-2==this.result&&this.game.point(this.players[0],this.players[1])),1<window.debug&&console.log("    elapsed time to end of ball.draw(): "+(performance.now()-window.start)+" ms"));b=this.result-1;a=1;do 0==this.moves[a]&&b!=a||this.context.fillRect(this.paddles[a].x,this.paddles[a].y,this.paddles[a].width,this.paddles[a].height);while(0<=--a);1<window.debug&&console.log("    elapsed time to to end of Court.draw(): "+(performance.now()-window.start)+" ms")};
Court.prototype.startPlay=function(){null==this.game&&(this.game=new Game(this));window.hideMessage();console.log("Starting play");this.paused=!1;this.update()};Court.prototype.pausePlay=function(){this.paused=!0;console.log("Play paused");window.message(window.court.pausedMessage)};Court.prototype.restartPlay=function(){this.paused=!1;window.hideMessage();console.log("Play restarted");this.update()};Court.prototype.togglePlay=function(){this.paused?this.restartPlay():this.pausePlay()};
Court.prototype.update=function(){if(!window.court.paused){if(window.debug){var a=performance.now();console.log("Time since last frame "+(a-window.start).toFixed(2)+" ms");window.start=a}window.court.draw();window.debug&&(a=performance.now(),console.log("court.draw() took "+(a-window.start)+" ms"));window.requestAnimationFrame(window.court.update)}};window.enableDebug=function(){window.debug=1};window.enableStats=function(){window.stats=!0};
